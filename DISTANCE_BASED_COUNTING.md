# Distance-Based Counting - –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ ‚ú®

## –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 2026-02-12

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### ‚ùå –ë—ã–ª–æ: –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ª–∏–Ω–∏–∏
- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- –°—á–∏—Ç–∞–ª–∏ –∫–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –ª–∏–Ω–∏—é (L‚ÜíR = IN, R‚ÜíL = OUT)
- –ó–∞–≤–∏—Å–µ–ª–æ –æ—Ç –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ

### ‚úÖ –°—Ç–∞–ª–æ: –ò–∑–º–µ—Ä–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- **–ò–∑–º–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–∞–º–µ—Ä—ã** –ø–æ —Ä–∞–∑–º–µ—Ä—É bounding box
- **–ü—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è** (box —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è) = **IN** ‚úÖ
- **–£–¥–∞–ª—è–µ—Ç—Å—è** (box —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è) = **OUT** ‚úÖ
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ

---

## üî¨ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏–Ω—Ü–∏–ø –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

```
–ß–µ–ª–æ–≤–µ–∫ –¥–∞–ª–µ–∫–æ –æ—Ç –∫–∞–º–µ—Ä—ã:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚Üê –ú–∞–ª–µ–Ω—å–∫–∏–π box (–º–∞–ª–∞—è –ø–ª–æ—â–∞–¥—å)
‚îÇ  üë§ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ß–µ–ª–æ–≤–µ–∫ –±–ª–∏–∑–∫–æ –∫ –∫–∞–º–µ—Ä–µ:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚Üê –ë–æ–ª—å—à–æ–π box (–±–æ–ª—å—à–∞—è –ø–ª–æ—â–∞–¥—å)
‚îÇ              ‚îÇ
‚îÇ      üë§      ‚îÇ
‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–§–æ—Ä–º—É–ª–∞**: `bbox_area = (x2 - x1) * (y2 - y1)`

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥—Å—á–µ—Ç–∞

```python
1. –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ–º —á–µ–ª–æ–≤–µ–∫–∞ ‚Üí –ø–æ–ª—É—á–∞–µ–º bounding box
2. –í—ã—á–∏—Å–ª—è–µ–º –ø–ª–æ—â–∞–¥—å box ‚Üí bbox_area
3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 –∏–∑–º–µ—Ä–µ–Ω–∏–π
4. –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è
5. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Å—Ä–µ–¥–Ω–∏–º:
   
   area_change = (new_area - old_avg_area) / old_avg_area
   
   if area_change > +15%:  ‚Üê Box —Ä–∞—Å—Ç–µ—Ç
       ‚Üí –ü–†–ò–ë–õ–ò–ñ–ê–ï–¢–°–Ø
       ‚Üí –°—á–∏—Ç–∞–µ–º –∫–∞–∫ IN ‚úÖ
   
   elif area_change < -15%:  ‚Üê Box —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
       ‚Üí –£–î–ê–õ–Ø–ï–¢–°–Ø
       ‚Üí –°—á–∏—Ç–∞–µ–º –∫–∞–∫ OUT ‚úÖ
   
   else:
       ‚Üí –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
       ‚Üí –ù–µ —Å—á–∏—Ç–∞–µ–º
```

### –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

- –ö–∞–∂–¥—ã–π track —Å—á–∏—Ç–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑** –≤ –∫–∞–∂–¥–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
- –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –ø—Ä–∏–±–ª–∏–∑–∏–ª—Å—è ‚Üí –∑–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ IN
- –ï—Å–ª–∏ –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –∫ –∫–∞–º–µ—Ä–µ ‚Üí –Ω–µ —Å—á–∏—Ç–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω –Ω–∞—á–Ω–µ—Ç **—É–¥–∞–ª—è—Ç—å—Å—è** ‚Üí –º–æ–∂–µ–º –∑–∞—Å—á–∏—Ç–∞—Ç—å OUT

---

## üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –≤–∏–¥–µ–æ

### –¶–≤–µ—Ç–∞ bounding boxes:

| –¶–≤–µ—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| üü¢ **–ó–µ–ª–µ–Ω—ã–π** | –°–æ–±—ã—Ç–∏–µ IN (—Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞—Å—á–∏—Ç–∞–ª–∏) |
| üî¥ **–ö—Ä–∞—Å–Ω—ã–π** | –°–æ–±—ã—Ç–∏–µ OUT (—Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞—Å—á–∏—Ç–∞–ª–∏) |
| üîµ **–ì–æ–ª—É–±–æ–π** | –ü—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è (–Ω–æ –µ—â–µ –Ω–µ –∑–∞—Å—á–∏—Ç–∞–Ω) |
| üü° **–ñ–µ–ª—Ç—ã–π** | –£–¥–∞–ª—è–µ—Ç—Å—è (–Ω–æ –µ—â–µ –Ω–µ –∑–∞—Å—á–∏—Ç–∞–Ω) |
| üü† **–û—Ä–∞–Ω–∂–µ–≤—ã–π** | –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π (–Ω–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è) |

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:

- `ID:42` - –Ω–æ–º–µ—Ä —Ç—Ä–µ–∫–∞
- `ID:42 ‚Üí` - –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –∫–∞–º–µ—Ä–µ
- `ID:42 ‚Üê` - —É–¥–∞–ª—è–µ—Ç—Å—è –æ—Ç –∫–∞–º–µ—Ä—ã  
- `ID:42 ‚úìIN` - –∑–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ –≤—Ö–æ–¥
- `ID:42 ‚úìOUT` - –∑–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ –≤—ã—Ö–æ–¥

### –õ–µ–≥–µ–Ω–¥–∞ (—Å–≤–µ—Ä—Ö—É –ø–æ —Ü–µ–Ω—Ç—Ä—É):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Üí  IN (Approaching)  ‚Üê  OUT (Away) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å (–ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª):

```
IN: 5   OUT: 3
Active: 2
FPS: 28.5
Mode: Distance-based
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä:

```bash
# –ü–æ—Ä–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–æ—â–∞–¥–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è
export PC_AREA_CHANGE_THRESHOLD=0.15  # 15% (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```

**–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å**:
- `0.10` (10%) - –±–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π, –±–æ–ª—å—à–µ —Å–æ–±—ã—Ç–∏–π
- `0.15` (15%) - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `0.20` (20%) - –º–µ–Ω–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π, —Ç–æ–ª—å–∫–æ —è–≤–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è

### –î—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```bash
# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç—Ä–µ–∫–∞ –±–µ–∑ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–π
export PC_MAX_AGE_SECONDS=2.0

# –î–µ—Ç–µ–∫—Ü–∏—è
export PC_CONF_THRESHOLD=0.45
export PC_RESIZE_WIDTH=960
```

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í—Ö–æ–¥ –≤ –º–∞–≥–∞–∑–∏–Ω/–æ—Ñ–∏—Å

```
–ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –¥–≤–µ—Ä–∏:
Frame 1:  –ú–∞–ª–µ–Ω—å–∫–∏–π box (–¥–∞–ª–µ–∫–æ)     area = 1000
Frame 5:  –°—Ä–µ–¥–Ω–∏–π box                area = 1200 (+20%)
Frame 10: –ë–æ–ª—å—à–æ–π box (–±–ª–∏–∑–∫–æ)       area = 1500 (+25%)
          ‚Üí area_change > 15%
          ‚Üí –ó–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ IN ‚úÖ

–ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å —É—Ö–æ–¥–∏—Ç:
Frame 15: –ë–æ–ª—å—à–æ–π box                area = 1500
Frame 20: –°—Ä–µ–¥–Ω–∏–π box                area = 1200 (-20%)
Frame 25: –ú–∞–ª–µ–Ω—å–∫–∏–π box (–¥–∞–ª–µ–∫–æ)     area = 900 (-25%)
          ‚Üí area_change < -15%
          ‚Üí –ó–∞—Å—á–∏—Ç–∞–Ω –∫–∞–∫ OUT ‚úÖ
```

### –ü—Ä–æ—Ö–æ–¥ –º–∏–º–æ –∫–∞–º–µ—Ä—ã

```
–ß–µ–ª–æ–≤–µ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –º–∏–º–æ (–Ω–µ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è/–Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è):
Frame 1:  box area = 1000
Frame 5:  box area = 1050 (+5%)
Frame 10: box area = 980 (-2%)
          ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏—è < 15%
          ‚Üí –ù–ï —Å—á–∏—Ç–∞–µ–º ‚úì
```

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### ‚úÖ –ü–ª—é—Å—ã:

1. **–ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏—è**
   - –ß–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç —Ö–æ–¥–∏—Ç—å –ø–æ –≤—Å–µ–º—É –∫–∞–¥—Ä—É
   - –ì–ª–∞–≤–Ω–æ–µ - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –∫/–æ—Ç –∫–∞–º–µ—Ä—ã

2. **–ë–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞**
   - IN = —á–µ–ª–æ–≤–µ–∫ –∑–∞—Ö–æ–¥–∏—Ç (–ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è)
   - OUT = —á–µ–ª–æ–≤–µ–∫ —É—Ö–æ–¥–∏—Ç (—É–¥–∞–ª—è–µ—Ç—Å—è)

3. **–ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π**
   - –õ—é–¥–∏ –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ –º–∏–º–æ –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è
   - –¢–æ–ª—å–∫–æ —è–≤–Ω–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ

4. **–õ—É—á—à–µ –¥–ª—è —É–∑–∫–∏—Ö –ø—Ä–æ—Ö–æ–¥–æ–≤**
   - –ù–µ –Ω—É–∂–Ω–æ —Ç–æ—á–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ª–∏–Ω–∏—é
   - –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –Ω–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É

### ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

1. **–¢—Ä–µ–±—É–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –∫/–æ—Ç –∫–∞–º–µ—Ä—ã**
   - –ù–µ —Å—á–∏—Ç–∞–µ—Ç –µ—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∫–∞–º–µ—Ä–µ
   - –ö–∞–º–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —É –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞

2. **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –∫–∞–º–µ—Ä—ã**
   - –õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–≥–¥–∞ –∫–∞–º–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –≤—Ö–æ–¥
   - –ë–æ–∫–æ–≤–æ–π —Ä–∞–∫—É—Ä—Å –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –æ—à–∏–±–∫–∏

3. **–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –æ–∫–∫–ª—é–∑–∏–∏**
   - –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ —á–∞—Å—Ç–∏—á–Ω–æ —Å–∫—Ä—ã—Ç, –ø–ª–æ—â–∞–¥—å box –º–µ–Ω—è–µ—Ç—Å—è
   - –ú–æ–∂–µ—Ç –¥–∞—Ç—å –ª–æ–∂–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ

---

## üéÆ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8000

### –¢–µ—Å—Ç 1: –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ (IN)
1. –í—Å—Ç–∞–Ω—å—Ç–µ **–¥–∞–ª–µ–∫–æ** –æ—Ç –∫–∞–º–µ—Ä—ã
2. –ú–µ–¥–ª–µ–Ω–Ω–æ **–∏–¥–∏—Ç–µ –∫ –∫–∞–º–µ—Ä–µ**
3. –í—ã —É–≤–∏–¥–∏—Ç–µ:
   - Box —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
   - –¶–≤–µ—Ç –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –≥–æ–ª—É–±–æ–π `‚Üí`
   - –ö–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ > 15% ‚Üí **—Å—á–µ—Ç—á–∏–∫ IN —É–≤–µ–ª–∏—á–∏—Ç—Å—è**
   - Box —Å—Ç–∞–Ω–µ—Ç –∑–µ–ª–µ–Ω—ã–º —Å `‚úìIN`

### –¢–µ—Å—Ç 2: –£–¥–∞–ª–µ–Ω–∏–µ (OUT)
1. –í—Å—Ç–∞–Ω—å—Ç–µ **–±–ª–∏–∑–∫–æ** –∫ –∫–∞–º–µ—Ä–µ
2. –ú–µ–¥–ª–µ–Ω–Ω–æ **–æ—Ç—Ö–æ–¥–∏—Ç–µ –Ω–∞–∑–∞–¥**
3. –í—ã —É–≤–∏–¥–∏—Ç–µ:
   - Box —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
   - –¶–≤–µ—Ç –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –∂–µ–ª—Ç—ã–π `‚Üê`
   - –ö–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ > 15% ‚Üí **—Å—á–µ—Ç—á–∏–∫ OUT —É–≤–µ–ª–∏—á–∏—Ç—Å—è**
   - Box —Å—Ç–∞–Ω–µ—Ç –∫—Ä–∞—Å–Ω—ã–º —Å `‚úìOUT`

### –¢–µ—Å—Ç 3: –ü—Ä–æ—Ö–æ–¥ –º–∏–º–æ (–Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è)
1. –ò–¥–∏—Ç–µ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –∫–∞–º–µ—Ä–µ (—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ)
2. –ù–µ –ø—Ä–∏–±–ª–∏–∂–∞–π—Ç–µ—Å—å –∏ –Ω–µ —É–¥–∞–ª—è–π—Ç–µ—Å—å
3. –†–µ–∑—É–ª—å—Ç–∞—Ç:
   - Box –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
   - –¶–≤–µ—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ä–∞–Ω–∂–µ–≤—ã–º
   - **–°—á–µ—Ç—á–∏–∫–∏ –ù–ï –º–µ–Ω—è—é—Ç—Å—è** ‚úì

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### TrackState (–Ω–æ–≤—ã–µ –ø–æ–ª—è):

```python
@dataclass
class TrackState:
    track_id: int
    last_bbox_area: float          # –ü–ª–æ—â–∞–¥—å box
    movement_direction: str        # "APPROACHING" or "MOVING_AWAY"
    counted_direction: str         # "IN" or "OUT" or None
    distance_history: list         # –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 –ø–ª–æ—â–∞–¥–µ–π
```

### –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ:

```python
# –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∏–∑–º–µ—Ä–µ–Ω–∏–π
distance_history = [1000, 1050, 1100, 1150, 1200]

# –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ
avg_area = sum(distance_history) / 5  # = 1100

# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å —Å—Ä–µ–¥–Ω–∏–º
new_area = 1400
change = (1400 - 1100) / 1100 = 0.27 = 27%

# 27% > 15% threshold ‚Üí –ó–∞—Å—á–∏—Ç—ã–≤–∞–µ–º!
```

### –ü–æ—Ä–æ–≥ 15%:

–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ 15%?
- –°–ª–∏—à–∫–æ–º –º–∞–ª–æ (5%) ‚Üí –º–Ω–æ–≥–æ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –æ—Ç –¥–∂–∏—Ç—Ç–µ—Ä–∞
- –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ (30%) ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è
- 15% - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è —Ç–∏–ø–∏—á–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è

---

## üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞

### –ü–ª–æ—â–∞–¥—å bounding box:

```
–ü–ª–æ—â–∞–¥—å = –®–∏—Ä–∏–Ω–∞ √ó –í—ã—Å–æ—Ç–∞
bbox_area = (x2 - x1) √ó (y2 - y1)
```

### –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:

```
relative_change = (new_area - old_avg_area) / old_avg_area

–ü—Ä–∏–º–µ—Ä—ã:
- old = 1000, new = 1200 ‚Üí change = +0.20 = +20% ‚úì IN
- old = 1000, new = 800  ‚Üí change = -0.20 = -20% ‚úì OUT
- old = 1000, new = 1100 ‚Üí change = +0.10 = +10% ‚úó –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
```

### –°–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ:

```
history = [a1, a2, a3, a4, a5]
average = (a1 + a2 + a3 + a4 + a5) / 5

–ó–∞—á–µ–º?
- –°–≥–ª–∞–∂–∏–≤–∞–µ—Ç –¥–∂–∏—Ç—Ç–µ—Ä –¥–µ—Ç–µ–∫—Ü–∏–∏
- –£—Å—Ç—Ä–∞–Ω—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –≤—ã–±—Ä–æ—Å—ã
- –î–µ–ª–∞–µ—Ç –ø–æ–¥—Å—á–µ—Ç –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º
```

---

## üéõÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### .env —Ñ–∞–π–ª:

```bash
# Distance-based counting
PC_AREA_CHANGE_THRESHOLD=0.15    # 15% –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–æ—â–∞–¥–∏

# Camera
PC_CAMERA_INDEX=0
PC_RESIZE_WIDTH=960

# Model
PC_MODEL_NAME=yolov8n.pt
PC_CONF_THRESHOLD=0.45

# Track management  
PC_MAX_AGE_SECONDS=2.0

# Server
PC_PORT=8000
PC_SHOW_DEBUG_WINDOW=false

# Required for macOS camera access
OPENCV_AVFOUNDATION_SKIP_AUTH=1
```

---

## üöÄ –ó–∞–ø—É—Å–∫

```bash
cd /Users/alextabula/Desktop/vision

# –° –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
OPENCV_AVFOUNDATION_SKIP_AUTH=1 \
PC_SHOW_DEBUG_WINDOW=false \
.venv/bin/python run.py --no-debug-window
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –∏ –ø—Ä–æ—Å—Ç–æ:

```bash
.venv/bin/python run.py --no-debug-window
```

---

## üìä –°—Ç–∞—Ç—É—Å: –†–ê–ë–û–¢–ê–ï–¢! ‚úÖ

```
‚úì Camera initialized: 960x540
‚úì Model loaded successfully
‚úì Counter initialized: distance-based mode (threshold=15%)
‚úì CV Worker ready
```

### –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- Camera: **ONLINE**
- Model: **LOADED**
- Active tracks: **1** (—É–∂–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω —á–µ–ª–æ–≤–µ–∫!)
- Mode: **Distance-based** üéØ

---

## üåê –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000

–í—ã —É–≤–∏–¥–∏—Ç–µ:
- üìπ –í–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä—ã (–±–µ–∑ –ª–∏–Ω–∏–∏!)
- üü¢/üî¥/üîµ/üü° –¶–≤–µ—Ç–Ω—ã–µ —Ä–∞–º–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
- ‚Üí –°—Ç—Ä–µ–ª–∫–∞ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è
- ‚Üê –°—Ç—Ä–µ–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
- ‚úìIN / ‚úìOUT –∫–æ–≥–¥–∞ –∑–∞—Å—á–∏—Ç–∞–Ω–æ
- –õ–µ–≥–µ–Ω–¥—É —Å–≤–µ—Ä—Ö—É
- –°—á–µ—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üéØ –ò—Ç–æ–≥

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Å—á–∏—Ç–∞–µ—Ç –ª—é–¥–µ–π –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –¥–æ –∫–∞–º–µ—Ä—ã:**

- ‚úÖ –ü—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è ‚Üí IN
- ‚úÖ –£–¥–∞–ª—è–µ—Ç—Å—è ‚Üí OUT
- ‚úÖ –ë–µ–∑ –ª–∏–Ω–∏–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- ‚úÖ –ë–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–∞–¥—Ä–µ

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
