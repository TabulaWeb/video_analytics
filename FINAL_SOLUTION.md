# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ IP –∫–∞–º–µ—Ä—ã —á–µ—Ä–µ–∑ MediaMTX

## –ü—Ä–æ–±–ª–µ–º–∞

OpenCV –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ –∫–∞–º–µ—Ä–µ (`No route to host`), —Ö–æ—Ç—è VLC —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–ü—Ä–∏—á–∏–Ω–∞:** macOS Firewall –∏–ª–∏ network policy –±–ª–æ–∫–∏—Ä—É–µ—Ç Python/OpenCV –æ—Ç –ø—Ä—è–º–æ–≥–æ RTSP –¥–æ—Å—Ç—É–ø–∞ –∫ IP –∫–∞–º–µ—Ä–µ.

## –†–µ—à–µ–Ω–∏–µ: MediaMTX –∫–∞–∫ proxy

MediaMTX –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å RTSP –æ—Ç –∫–∞–º–µ—Ä—ã –∏ –æ—Ç–¥–∞–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `localhost:8554`. OpenCV –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `localhost` ‚Äî —ç—Ç–æ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!

```
Dahua Camera (192.168.0.201:554)
         ‚Üì RTSP
    MediaMTX (Docker)
         ‚Üì RTSP localhost
    OpenCV + YOLO
```

## –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ MediaMTX

```bash
cd /Users/alextabula/Desktop/vision
docker compose up -d
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
docker compose logs -f mediamtx
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
INF [path dahua] source ready
```

## –®–∞–≥ 2: –ò–∑–º–µ–Ω–∏—Ç–µ `.env` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è MediaMTX

–û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:

```bash
# –í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–∞–º–µ—Ä–µ:
# PC_DAHUA_IP=192.168.0.201

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MediaMTX –ª–æ–∫–∞–ª—å–Ω–æ:
PC_DAHUA_IP=localhost
PC_DAHUA_PORT=8554
PC_DAHUA_USERNAME=
PC_DAHUA_PASSWORD=
PC_DAHUA_CHANNEL=1
PC_DAHUA_SUBTYPE=0
```

**–ò–õ–ò** –µ—â–µ –ø—Ä–æ—â–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º–æ–π RTSP URL:

```bash
PC_CAMERA_INDEX=rtsp://localhost:8554/dahua
```

## –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
pkill -9 -f "run.py"
.venv/bin/python run.py --no-debug-window
```

## –®–∞–≥ 4: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –∫–∞–º–µ—Ä—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

http://localhost:8000 ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ "IP –∫–∞–º–µ—Ä–∞ Dahua"

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∫–∞–º–µ—Ä—É

–ï—Å–ª–∏ MediaMTX + Docker –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ–±-–∫–∞–º–µ—Ä—É:

–í `.env`:
```bash
PC_CAMERA_INDEX=0
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –≤–µ–±-–∫–∞–º–µ—Ä–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–µ—Ç–µ–∫—Ü–∏–µ–π –∏ –ø–æ–¥—Å—á–µ—Ç–æ–º.

---

## –ü–æ—á–µ–º—É OpenCV –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é?

1. **macOS Firewall** –±–ª–æ–∫–∏—Ä—É–µ—Ç Python –æ—Ç –∏—Å—Ö–æ–¥—è—â–∏—Ö TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. **Network policy** –Ω–∞ –∫–∞–º–µ—Ä–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö User-Agent
3. **OpenCV/FFmpeg** –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–±–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ security policy
4. **–ö–∞–º–µ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç** —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é VLC –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, –∞ OpenCV –Ω–µ—Ç

MediaMTX —Ä–µ—à–∞–µ—Ç –≤—Å–µ —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Ç–∞–∫ –∫–∞–∫ –æ–Ω:
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ Docker (–æ—Ç–¥–µ–ª—å–Ω—ã–π network namespace)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç libav/ffmpeg (–∫–∞–∫ VLC)
- –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –û—Ç–¥–∞–µ—Ç –ø–æ—Ç–æ–∫ –ª–æ–∫–∞–ª—å–Ω–æ (localhost –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω)

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è MediaMTX

```bash
# –ó–∞–ø—É—Å–∫
docker compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose down

# –õ–æ–≥–∏
docker compose logs -f mediamtx

# –°—Ç–∞—Ç—É—Å
docker compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose restart mediamtx
```

---

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MediaMTX ‚Äî —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ
