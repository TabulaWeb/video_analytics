# Re-ID Troubleshooting: –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö —á–µ–ª–æ–≤–µ–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞–∫ –æ–¥–∏–Ω

## –ü—Ä–æ–±–ª–µ–º–∞

–°–∏—Å—Ç–µ–º–∞ Re-ID –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –ª—é–¥–µ–π –∫–∞–∫ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ person_id.

## –ü—Ä–∏—á–∏–Ω—ã

### 1. –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π threshold

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Track 5 detected ‚Üí Compare with P0001
Similarity: 0.68 (threshold: 0.65)
Match found! ‚Üí Assign P0001 ‚ùå (–Ω–æ —ç—Ç–æ –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫!)
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–≤—ã—Å–∏—Ç—å threshold –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
PC_REID_SIMILARITY_THRESHOLD=0.75  # –ë—ã–ª–æ 0.65
```

### 2. –ü–æ—Ö–æ–∂–∞—è –≤–Ω–µ—à–Ω–æ—Å—Ç—å

**–ü—Ä–∏—á–∏–Ω—ã:**
- –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –æ–¥–µ–∂–¥–∞ (—Ü–≤–µ—Ç, —Å—Ç–∏–ª—å)
- –ü–æ—Ö–æ–∂–∏–π —Ä–æ—Å—Ç –∏ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ
- –ü–ª–æ—Ö–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ (—Å–∏—Å—Ç–µ–º–∞ –≤–∏–¥–∏—Ç —Ö—É–∂–µ)

**–ü—Ä–∏–º–µ—Ä—ã:**
```
Person A: –°–∏–Ω—è—è –∫—É—Ä—Ç–∫–∞, –≤—ã—Å–æ–∫–∏–π
Person B: –°–∏–Ω—è—è –∫—É—Ä—Ç–∫–∞, –≤—ã—Å–æ–∫–∏–π
‚Üí Similarity: 0.82 ‚Üí –û—à–∏–±–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
```

### 3. –ö–∞—á–µ—Å—Ç–≤–æ embeddings

–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
- –¶–≤–µ—Ç–æ–≤–∞—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ (HSV)
- HOG (—Ñ–æ—Ä–º–∞)
- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–≤–µ—Ä—Ö/–Ω–∏–∑ –æ–¥–µ–∂–¥—ã)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ –≤–∏–¥–∏—Ç –ª–∏—Ü–∞
- –ù–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- –ü–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ —Ü–≤–µ—Ç –æ–¥–µ–∂–¥—ã

---

## –†–µ—à–µ–Ω–∏–µ: –ü–æ–≤—ã—à–µ–Ω–∏–µ threshold

### –ß—Ç–æ —è —Å–¥–µ–ª–∞–ª:

1. **–ü–æ–≤—ã—Å–∏–ª threshold —Å 0.65 –¥–æ 0.75**
```bash
# –í .env —Ñ–∞–π–ª–µ
PC_REID_SIMILARITY_THRESHOLD=0.75
```

2. **–î–æ–±–∞–≤–∏–ª debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ similarity scores:
```
Re-ID similarities:
  P0001: 0.882 ‚úì MATCH
  P0002: 0.623 ‚úó below threshold
  P0003: 0.541 ‚úó below threshold
```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏**

---

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª–æ—Å—å

### 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ

–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å "Re-ID similarities":
```bash
tail -f /path/to/terminal.txt | grep -A 5 "Re-ID similarities"
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚ú® New person registered: P0003 (track_id=15)
  Re-ID similarities:
    P0001: 0.645 ‚úó below threshold
    P0002: 0.598 ‚úó below threshold
‚Üí –ù–æ–≤—ã–π —á–µ–ª–æ–≤–µ–∫, –Ω–µ —Å–æ–≤–ø–∞–ª –Ω–∏ —Å –∫–µ–º! ‚úì
```

### 2. API –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
curl http://localhost:8000/api/reid/persons
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª—é–¥–µ–π:
```json
{
  "count": 3,
  "persons": [
    {"person_id": "P0001", "appearance_count": 5},
    {"person_id": "P0002", "appearance_count": 3},
    {"person_id": "P0003", "appearance_count": 1}
  ]
}
```

### 3. –í Web UI

–ù–∞–∂–º–∏—Ç–µ "üë§ Known Persons" - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ person_id –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ª—é–¥–µ–π.

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ threshold

### –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

```
0.50-0.60 - –û—á–µ–Ω—å permissive
  ‚úì –•–æ—Ä–æ—à–æ —É–∑–Ω–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø–ª–æ—Ö–æ–º –æ—Å–≤–µ—â–µ–Ω–∏–∏
  ‚úó –ú–æ–∂–µ—Ç –ø—É—Ç–∞—Ç—å –ø–æ—Ö–æ–∂–∏—Ö –ª—é–¥–µ–π

0.65-0.70 - –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
  ‚úì –•–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å
  ‚úó –ú–æ–∂–µ—Ç –ø—É—Ç–∞—Ç—å –ø—Ä–∏ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ–π –æ–¥–µ–∂–¥–µ

0.75-0.80 - –°—Ç—Ä–æ–≥–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö)
  ‚úì –†–µ–¥–∫–æ –ø—É—Ç–∞–µ—Ç —Ä–∞–∑–Ω—ã—Ö –ª—é–¥–µ–π
  ‚úó –ú–æ–∂–µ—Ç –Ω–µ —É–∑–Ω–∞—Ç—å —Ç–æ–≥–æ –∂–µ —á–µ–ª–æ–≤–µ–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–≤–µ—â–µ–Ω–∏—è

0.85+ - –û—á–µ–Ω—å —Å—Ç—Ä–æ–≥–∏–π
  ‚úì –ü–æ—á—Ç–∏ –Ω–µ –æ—à–∏–±–∞–µ—Ç—Å—è
  ‚úó –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ä–µ–¥–µ:

**–û—Ñ–∏—Å —Å —Ö–æ—Ä–æ—à–∏–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º:**
```bash
PC_REID_SIMILARITY_THRESHOLD=0.75
```

**–ú–∞–≥–∞–∑–∏–Ω —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º:**
```bash
PC_REID_SIMILARITY_THRESHOLD=0.65
```

**–£–ª–∏—Ü–∞ (—Å–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è):**
```bash
PC_REID_SIMILARITY_THRESHOLD=0.60
```

**–õ—é–¥–∏ –≤ —É–Ω–∏—Ñ–æ—Ä–º–µ (–ø–æ—Ö–æ–∂–∞—è –æ–¥–µ–∂–¥–∞):**
```bash
PC_REID_SIMILARITY_THRESHOLD=0.80
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ

```bash
curl -X POST http://localhost:8000/api/reid/clear
```

–≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ person_id –∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—á–Ω–µ—Ç —Å –Ω—É–ª—è.

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ª—é–¥–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–µ

–í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —á–µ–ª–æ–≤–µ–∫:
- –£—à–µ–ª –∏ –≤–µ—Ä–Ω—É–ª—Å—è
- –°–º–µ–Ω–∏–ª —É–≥–æ–ª –∫ –∫–∞–º–µ—Ä–µ
- –ò–∑–º–µ–Ω–∏–ª–æ—Å—å –æ—Å–≤–µ—â–µ–Ω–∏–µ

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ Re-ID —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úÖ

### 3. –£–ª—É—á—à–∏—Ç—å —É—Å–ª–æ–≤–∏—è —Å—ä–µ–º–∫–∏

**–û—Å–≤–µ—â–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ —Å–≤–µ—Ç–∞
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Ç–µ–Ω–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ

**–ö–∞–º–µ—Ä–∞:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥—Ä—É–¥–∏ (–Ω–µ —Å–≤–µ—Ä—Ö—É)
- –ù–∞–ø—Ä–∞–≤—å—Ç–µ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ (–Ω–µ –ø–æ–¥ —É–≥–ª–æ–º)
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —Ö–æ—Ä–æ—à–µ–º —Ñ–æ–∫—É—Å–µ

**–û–¥–µ–∂–¥–∞:**
- –ï—Å–ª–∏ –≤—Å–µ –≤ —É–Ω–∏—Ñ–æ—Ä–º–µ ‚Üí –ø–æ–≤—ã—Å—å—Ç–µ threshold –¥–æ 0.80+
- –¶–≤–µ—Ç–Ω–∞—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–¥–µ–∂–¥–∞ ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ similarity scores –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:

```
Track 15 detected
  Re-ID similarities:
    P0001: 0.882 ‚úì MATCH
    P0002: 0.623 ‚úó below threshold
‚Üí Assigned P0001

Track 16 detected
  Re-ID similarities:
    P0001: 0.612 ‚úó below threshold
    P0002: 0.556 ‚úó below threshold
‚Üí New person registered: P0003
```

**–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Ü–∏—Ñ—Ä—ã:**
- 0.90+ : –ü–æ—á—Ç–∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —Ç–æ—Ç –∂–µ —á–µ–ª–æ–≤–µ–∫
- 0.75-0.90 : –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Ç–æ—Ç –∂–µ (–ø—Ä–∏ threshold=0.75)
- 0.60-0.75 : –°–ø–æ—Ä–Ω–æ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç threshold)
- < 0.60 : –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏

---

## –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
PC_REID_SIMILARITY_THRESHOLD=0.75  # –ü–æ–≤—ã—à–µ–Ω –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è –ª—é–¥–µ–π
PC_REID_MAX_PERSONS=100            # –ú–∞–∫—Å–∏–º—É–º –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª—é–¥–µ–π
PC_ENABLE_REID=true                 # Re-ID –≤–∫–ª—é—á–µ–Ω
```

---

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –õ—é–¥–∏ –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –æ–¥–µ–∂–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
Person A: –ë–µ–ª–∞—è —Ä—É–±–∞—à–∫–∞ + —á–µ—Ä–Ω—ã–µ –±—Ä—é–∫–∏
Person B: –ë–µ–ª–∞—è —Ä—É–±–∞—à–∫–∞ + —á–µ—Ä–Ω—ã–µ –±—Ä—é–∫–∏
‚Üí Similarity: 0.88 ‚Üí –ü—É—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ threshold=0.75
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ï—â–µ –±–æ–ª—å—à–µ –ø–æ–≤—ã—Å–∏—Ç—å threshold
PC_REID_SIMILARITY_THRESHOLD=0.85
```

–ò–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å Re-ID:
```bash
PC_ENABLE_REID=false
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–ª–æ—Ö–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢–µ–Ω–∏
- –¢–µ–º–Ω—ã–µ –∑–æ–Ω—ã
- –ë–ª–∏–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –£–ª—É—á—à–∏—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏–µ
- –ü–æ–Ω–∏–∑–∏—Ç—å threshold –æ–±—Ä–∞—Ç–Ω–æ –¥–æ 0.65-0.70

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–∞–º–µ—Ä–∞ –ø–æ–¥ —É–≥–ª–æ–º

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–∞–º–µ—Ä–∞ —Å–≤–µ—Ä—Ö—É –∏–ª–∏ —Å–±–æ–∫—É
- –í–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å —á–µ–ª–æ–≤–µ–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≥—Ä—É–¥–∏
- –ù–∞–ø—Ä–∞–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ

---

## Summary

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- Threshold –ø–æ–≤—ã—à–µ–Ω: 0.65 ‚Üí 0.75
- –î–æ–±–∞–≤–ª–µ–Ω–æ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±–Ω–æ–≤–ª–µ–Ω .env —Ñ–∞–π–ª

üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –Ω–æ–≤—ã–µ person_id (P0003, P0004...)
- API: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π
- Web UI: –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π

‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–≤—ã—à–∞–π—Ç–µ threshold –µ—â–µ (0.80, 0.85)
- –ò–ª–∏ —É–ª—É—á—à–∞–π—Ç–µ —É—Å–ª–æ–≤–∏—è —Å—ä–µ–º–∫–∏
- –ò–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ Re-ID –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç

---

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏!**
**–¢–µ–ø–µ—Ä—å threshold = 0.75 (–±—ã–ª–æ 0.65)**

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å –¥–≤—É–º—è —Ä–∞–∑–Ω—ã–º–∏ –ª—é–¥—å–º–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Ä–∞–∑–Ω—ã–µ person_id! ‚úÖ
