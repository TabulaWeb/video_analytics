# üé• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é Dahua IP –∫–∞–º–µ—Ä—ã

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

–Ø –Ω–∞—Å—Ç—Ä–æ–∏–ª –ø–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Dahua IP –∫–∞–º–µ—Ä–æ–π:

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`docker-compose.yml`** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MediaMTX —Å–µ—Ä–≤–µ—Ä–∞
2. **`infra/mediamtx/mediamtx.yml`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (RTSP ‚Üí HLS)
3. **`.env.example`** ‚Äî –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤)
4. **`README_CAMERA.md`** ‚Äî –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å troubleshooting
5. **`QUICKSTART_CAMERA.md`** ‚Äî –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`app/static/index.html`** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω video player —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
2. **`app/static/main.js`** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è hls.js –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è HLS
3. **`.env`** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DAHUA_PASSWORD` (–Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å!)

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –í–ê–ú

### –®–∞–≥ 1: –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–æ–ª—å –æ—Ç –∫–∞–º–µ—Ä—ã

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª **`.env`** –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:

```bash
DAHUA_PASSWORD=your_camera_password_here
```

–ù–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å:

```bash
DAHUA_PASSWORD=–≤–∞—à_–Ω–∞—Å—Ç–æ—è—â–∏–π_–ø–∞—Ä–æ–ª—å_123
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –≠—Ç–æ—Ç —Ñ–∞–π–ª —É–∂–µ –≤ `.gitignore`, –ø–∞—Ä–æ–ª—å –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ git!

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–º–µ—Ä—ã

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–∞–º–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å–µ—Ç–∏
ping 192.168.0.200
```

–ï—Å–ª–∏ –ø–∏–Ω–≥ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- IP –∞–¥—Ä–µ—Å –∫–∞–º–µ—Ä—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–æ–π!)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–æ–π –∂–µ —Å–µ—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã (RTSP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω)

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ MediaMTX

```bash
docker compose up -d
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
docker compose logs -f mediamtx
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
INF [HLS] [path dahua] source ready
INF [HLS] [conn 192.168.0.200:554] stream is ready
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ ‚Äî —Å–º. **README_CAMERA.md** (—Ä–∞–∑–¥–µ–ª Troubleshooting).

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HLS –ø–æ—Ç–æ–∫

**–í–∞—Ä–∏–∞–Ω—Ç A:** –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```
http://localhost:8888/dahua/index.m3u8
```

–î–æ–ª–∂–µ–Ω —Å–∫–∞—á–∞—Ç—å—Å—è —Ñ–∞–π–ª `.m3u8` (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ).

**–í–∞—Ä–∏–∞–Ω—Ç B:** –û—Ç–∫—Ä–æ–π—Ç–µ –≤ VLC Media Player
1. `Media` ‚Üí `Open Network Stream`
2. URL: `http://localhost:8888/dahua/index.m3u8`
3. –ù–∞–∂–º–∏—Ç–µ `Play`

–í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å—Å—è! üéâ

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (`Ctrl+C` –∏–ª–∏ `pkill -f run.py`), –∑–∞—Ç–µ–º:

```bash
.venv/bin/python run.py --no-debug-window
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000
2. –í –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –≤–∏–¥–µ–æ –Ω–∞–π–¥–∏—Ç–µ –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é **"–ò—Å—Ç–æ—á–Ω–∏–∫:"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"IP –∫–∞–º–µ—Ä–∞ Dahua (HLS)"**
4. –ß–µ—Ä–µ–∑ 2-5 —Å–µ–∫—É–Ω–¥ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å –∫–∞–º–µ—Ä—ã

## üéõÔ∏è –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤–∏–¥–µ–æ

–í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã **2 –∏—Å—Ç–æ—á–Ω–∏–∫–∞**:

1. **"–í–µ–±-–∫–∞–º–µ—Ä–∞ (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è)"** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –õ–æ–∫–∞–ª—å–Ω–∞—è USB –≤–µ–±-–∫–∞–º–µ—Ä–∞ (–∏–Ω–¥–µ–∫—Å 0)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ OpenCV + YOLO
   - –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤, –ª–∏–Ω–∏–∏, bbox
   - –§–æ—Ä–º–∞—Ç: MJPEG

2. **"IP –∫–∞–º–µ—Ä–∞ Dahua (HLS)"**
   - –ü—Ä—è–º–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Å IP –∫–∞–º–µ—Ä—ã
   - –ß–µ—Ä–µ–∑ MediaMTX —Å–µ—Ä–≤–µ—Ä
   - –ë–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—á–∏—Å—Ç–æ–µ –≤–∏–¥–µ–æ)
   - –§–æ—Ä–º–∞—Ç: HLS (HTTP Live Streaming)
   - –ó–∞–¥–µ—Ä–∂–∫–∞: 2-5 —Å–µ–∫—É–Ω–¥ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è HLS)

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Dahua Camera   ‚îÇ
‚îÇ  (192.168.0.200)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ RTSP (port 554)
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    MediaMTX     ‚îÇ
‚îÇ  (Docker)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ HLS (port 8888)
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Web Browser    ‚îÇ
‚îÇ  (hls.js player)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–º–µ—Ä—ã

### IP –∞–¥—Ä–µ—Å –∫–∞–º–µ—Ä—ã: `192.168.0.200`

–ï—Å–ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–æ–π IP, –∏–∑–º–µ–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª–µ `infra/mediamtx/mediamtx.yml`:

```yaml
paths:
  dahua:
    source: rtsp://admin:${DAHUA_PASSWORD}@–í–ê–®_IP:554/cam/realmonitor?channel=1&subtype=0
```

### –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–∞

- **`subtype=0`** ‚Äî main stream (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, ~1080p, 2-4 Mbps)
- **`subtype=1`** ‚Äî sub stream (–Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, ~360p, 512 Kbps)

–î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ `subtype=1` –≤ `mediamtx.yml`.

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Ç–æ–∫"

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ MediaMTX
docker compose logs mediamtx | grep -i error

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–∞–º–µ—Ä–µ
ping 192.168.0.200

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å
cat .env | grep DAHUA_PASSWORD

# 4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ RTSP –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ VLC
# rtsp://admin:–ø–∞—Ä–æ–ª—å@192.168.0.200:554/cam/realmonitor?channel=1&subtype=0
```

### –ü—Ä–æ–±–ª–µ–º–∞: MediaMTX –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker compose down
docker compose up -d

# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
docker compose logs -f mediamtx
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í–∏–¥–µ–æ —Ç–æ—Ä–º–æ–∑–∏—Ç

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sub stream (–º–µ–Ω—å—à–µ –±–∏—Ç—Ä–µ–π—Ç)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ç–∏: `docker stats people-counter-mediamtx`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–º–µ—Ä–∞ –≤ —Ç–æ–π –∂–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ (–Ω–µ —á–µ—Ä–µ–∑ VPN/—Ä–æ—É—Ç–µ—Ä)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[README_CAMERA.md](README_CAMERA.md)** ‚Äî –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **[QUICKSTART_CAMERA.md](QUICKSTART_CAMERA.md)** ‚Äî –∫—Ä–∞—Ç–∫–∏–π –≥–∞–π–¥
- **[MediaMTX Docs](https://github.com/bluenviron/mediamtx)** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç—Ä–∏–º–∏–Ω–≥-—Å–µ—Ä–≤–µ—Ä–∞
- **[HLS.js Docs](https://github.com/video-dev/hls.js/)** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è HLS –ø–ª–µ–µ—Ä–∞

## ‚úÖ Checklist

- [ ] –£–∫–∞–∑–∞–Ω —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ `.env`
- [ ] –ö–∞–º–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ (ping –ø—Ä–æ—Ö–æ–¥–∏—Ç)
- [ ] MediaMTX –∑–∞–ø—É—â–µ–Ω (`docker compose ps`)
- [ ] HLS –ø–æ—Ç–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ VLC
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ
- [ ] –í –±—Ä–∞—É–∑–µ—Ä–µ –¥–æ—Å—Ç—É–ø–Ω—ã –æ–±–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–∏–¥–µ–æ

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

1. ‚úÖ –í–µ–±-–∫–∞–º–µ—Ä–∞ —Å –¥–µ—Ç–µ–∫—Ü–∏–µ–π –∏ —Å—á–µ—Ç—á–∏–∫–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
2. ‚úÖ IP –∫–∞–º–µ—Ä–∞ Dahua —Å live-—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–µ–π —á–µ—Ä–µ–∑ HLS
3. ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫

---

**–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã** ‚Äî —Å–º. README_CAMERA.md (—Ä–∞–∑–¥–µ–ª Troubleshooting) –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É!
